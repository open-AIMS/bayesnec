<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running `bayesnec` • bayesnec</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running `bayesnec`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example2b.html">Model details</a>
    </li>
    <li>
      <a href="../articles/example3.html">Priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
    <li>
      <a href="../articles/example5.html">Running `bayesnec`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/bayesnec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running <code>bayesnec</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/master/vignettes/example5.Rmd" class="external-link"><code>vignettes/example5.Rmd</code></a></small>
      <div class="hidden name"><code>example5.Rmd</code></div>

    </div>

    
    
<p>The <code>bayesnec</code> package makes use of the R package
<code>brms</code> <span class="citation">(Paul Christian Bürkner 2017;
Paul-Christian Bürkner 2018)</span> (<a href="https://cran.r-project.org/package=brms" class="external-link uri">https://cran.r-project.org/package=brms</a>) which relies on
<code>stan</code> (<a href="https://mc-stan.org/" class="external-link uri">https://mc-stan.org/</a>). You will need to have either
<code>RStan</code> (<a href="https://mc-stan.org/users/interfaces/rstan.html" class="external-link uri">https://mc-stan.org/users/interfaces/rstan.html</a>) or
<code>cmdstanr</code>(<a href="https://mc-stan.org/cmdstanr/" class="external-link uri">https://mc-stan.org/cmdstanr/</a>) installed and configured
on your computer to run <code>bayesnec</code>.</p>
<p>Quick start guides can be found for both <code>RStan</code> <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link uri">https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started</a>
and <code>cmdstanr</code> <a href="https://mc-stan.org/cmdstanr/articles/cmdstanr.html" class="external-link uri">https://mc-stan.org/cmdstanr/articles/cmdstanr.html</a>.
However, in our experience getting either package to work can be a bit
fiddly, particularly on Windows machines.</p>
<p>We have prepared an installation workflow for <code>cmdstanr</code>
specifically for Windows 10 that may resolve issues if the above Quick
start links fail to result in a working version of <code>brms</code>.
Note that this workflow has also been known to resolve some issues with
<code>RStan</code>, although it was not developed with that
intention.</p>
<div class="section level2">
<h2 id="cmdstanr-installation-workflow">
<code>cmdstanr</code> installation workflow<a class="anchor" aria-label="anchor" href="#cmdstanr-installation-workflow"></a>
</h2>
<p>These instructions are derived from the instructions at <a href="https://mc-stan.org/docs/2_24/cmdstan-guide/cmdstan-installation.html" class="external-link uri">https://mc-stan.org/docs/2_24/cmdstan-guide/cmdstan-installation.html</a></p>
<p>The high level steps are:</p>
<ol style="list-style-type: decimal">
<li>Install <code>Rtools</code>, this is what <code>cmdstan</code> will
use to make the executables</li>
<li>Install <code>git</code>, this is will be used to get the
<code>cmdstan</code> code</li>
<li>Install <code>cmdstan</code>
</li>
<li>Test <code>cmdstan</code> and run a model</li>
</ol>
<p>These instructions assume you have R and Rstudio installed
already.</p>
<div class="section level3">
<h3 id="install-rtools">1. Install <code>Rtools</code><a class="anchor" aria-label="anchor" href="#install-rtools"></a>
</h3>
<ol style="list-style-type: lower-alpha">
<li><p>Install <code>Rtools</code> from <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/</a></p></li>
<li>
<p>Go to the install location and check that the following usr\bin
and mingw64\bin directories exist:</p>
<ul>
<li>C:\usr\bin</li>
<li>C:\mingw64\bin</li>
</ul>
</li>
</ol>
<p>Check that a <strong>mingw32-make.exe</strong> file is in one of
those directories.</p>
<p><code>RTools</code> may not always install
<strong>mingw32-make.exe</strong> but it can be installed manually if
needed by the following instructions:</p>
<p>Open <code>RTools Bash</code>, which comes with <code>RTools</code>
(hit Windows Key, type rtools bash, and hit enter). In the
<code>RTools Bash</code> console window, type:</p>
<p><code>pacman -Sy mingw-w64-x86_64-make</code></p>
<p>Check that the <code>mingw32-make.exe</code> file is in one of the
<code>RTools</code> folders listed in 1b.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Add the directories to to the Windows Path using the “Edit the
system environment variables” tool in Windows’ Control Panel. A step by
step guide on adding directories to the windows path can be found at <a href="https://www.architectryan.com/2018/03/17/add-to-the-path-on-windows-10/" class="external-link uri">https://www.architectryan.com/2018/03/17/add-to-the-path-on-windows-10/</a>.
Note that you will need administrator privileges on your computer to
edit the environment variables.</li>
</ol>
<ul>
<li>Put the path in the system paths section (bottom section)</li>
<li>Note that you can also add the path
<code>C:\cmdstan\stan\lib\stan_math\lib\tbb</code> to save having to do
it later (in the later install <code>cmdstan</code> step below)</li>
</ul>
<ol start="4" style="list-style-type: lower-alpha">
<li>
<p>Test the paths are set correctly</p>
<ul>
<li>Reboot your computer</li>
<li>Start up R studio</li>
<li>Navigate to the terminal (a tab co-located in the R console
panel)</li>
<li>Type <code>echo %PATH%</code>
</li>
<li>The paths you added should be in the output from that command. They
should look something like:
<ul>
<li><code>\c\RTools\RTools40\usr\bin</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Final check to see if it installed properly.</p></li>
</ol>
<p>In the terminal type:</p>
<p><code>g++ --version</code></p>
<p>and</p>
<p><code>mingw32-make --version</code></p>
<p>Check that it both return a version number. If they produce an error
there is a problem with the installation.</p>
</div>
<div class="section level3">
<h3 id="install-git">2. Install <code>git</code><a class="anchor" aria-label="anchor" href="#install-git"></a>
</h3>
<ol style="list-style-type: lower-alpha">
<li><p>If git is not already on your system, install it here: <a href="https://git-scm.com/download/win" class="external-link uri">https://git-scm.com/download/win</a></p></li>
<li>
<p>To check that git is installed. In RStudio:</p>
<ul>
<li>Navigate to the terminal</li>
<li>type <code>git --version</code>
</li>
<li>Check that it returns a version number. If it produces an error
there is a problem with the installation</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="intall-cmdstan">3. Intall <code>cmdstan</code><a class="anchor" aria-label="anchor" href="#intall-cmdstan"></a>
</h3>
<p>In R studio</p>
<p>a. Navigate to the terminal</p>
<p>b. change directory to c:\ drive using the code:
<code>cd \c</code></p>
<p>c. download latest version of cmdstan from githup - this may take a
few minutes:
<code>git clone https://github.com/stan-dev/cmdstan.git --recursive</code></p>
<p>d. change directory to where <code>cmdstan</code> is downloaded:
<code>cd cmdstan</code></p>
<p>e. clean up the space (just to be sure):
<code>mingw32-make clean-all</code></p>
<p>f. compile the code: <code>mingw32-make build</code></p>
<p>This will take a few minutes and should end with similar phrase as
“““— CmdStan v2.23.0 built —”“”</p>
<p>g. Add <code>cmdstan</code> library to system environment path by
adding <code>C:\cmdstan\stan\lib\stan_math\lib\tbb</code> to the path
(using the same instructions as 1.c.)</p>
<p>h. Reboot your computer</p>
<p>i. <code>cmdstan</code> is missing a file that must be manually added
to the <code>C:\cmdstan\make</code> folder. Open notepad and copy paste
the following two lines of text:</p>
<p><code>CXXFLAGS += -Wno-nonnull</code></p>
<p><code>TBB_CXXFLAGS= -U__MSVCRT_VERSION__ -D__MSVCRT_VERSION__=0x0E00</code></p>
<ol start="11" style="list-style-type: lower-alpha">
<li>Save the file with the name <code>local</code> and ensure that it
has no file extension. For example, if you used notepad the default file
extension is .txt which can be deleted by right clicking the file and
selecting rename. If you can’t see the file extensions, click the view
tab in your folder ribbon and make sure the
<code>file name extension</code> box is checked. Instructions for how to
remove a file extension can be found at: <a href="https://www.computerhope.com/issues/ch002089.htm" class="external-link uri">https://www.computerhope.com/issues/ch002089.htm</a>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="test-cmdstan-in-r-studio">4. Test cmdstan in R studio<a class="anchor" aria-label="anchor" href="#test-cmdstan-in-r-studio"></a>
</h3>
<ol style="list-style-type: lower-alpha">
<li>Install the R package <code>cmdstanr</code> following the
instructions at: <a href="https://mc-stan.org/cmdstanr/articles/cmdstanr.html" class="external-link uri">https://mc-stan.org/cmdstanr/articles/cmdstanr.html</a>
</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we recommend running this is a fresh R session or restarting your current session</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cmdstanr"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://mc-stan.org/r-packages/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make sure all these packages are installed and loaded.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cmdstanr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is cmdstanr version 0.5.3</span></span></code></pre>
<pre><code><span><span class="co">## - CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</span></span></code></pre>
<pre><code><span><span class="co">## - CmdStan path: /Users/dbarneche/.cmdstan/cmdstan-2.33.1</span></span></code></pre>
<pre><code><span><span class="co">## - CmdStan version: 2.33.1</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is posterior version 1.4.1</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'posterior'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     mad, sd, var</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     %in%, match</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is bayesplot version 1.10.0</span></span></code></pre>
<pre><code><span><span class="co">## - Online documentation and vignettes at mc-stan.org/bayesplot</span></span></code></pre>
<pre><code><span><span class="co">## - bayesplot theme set to bayesplot::theme_default()</span></span></code></pre>
<pre><code><span><span class="co">##    * Does _not_ affect other ggplot2 plots</span></span></code></pre>
<pre><code><span><span class="co">##    * See ?bayesplot_theme_set for details on theme setting</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'bayesplot'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:posterior':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     rhat</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:brms':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     rhat</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"brightblue"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Manually set the following options.</li>
</ol>
<p>Make sure the path points to the <code>cmdstan</code>
installation</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cmdstan_path</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/Users/dbarneche/.cmdstan/cmdstan-2.33.1"</span></span></code></pre>
<p>If not, manually set it</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set_cmdstan_path</span><span class="op">(</span><span class="st">"C:/cmdstan"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Path not set. Can't find directory: C:/cmdstan</span></span></code></pre>
<p>To use <code>cmdstan</code> as a backend for <code>brms</code> call
the relevant options.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>brms.backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span></code></pre></div>
<p>Setting the path and backend may be required each time you use
<code>cmdstan</code></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Check that your toolchain is set up properly.</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_cmdstan_toolchain</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The C++ toolchain required for CmdStan is setup properly!</span></span></code></pre>
<p>This should return the message
<code>The C++ toolchain required for CmdStan is setup properly!</code></p>
<div class="section level4">
<h4 id="compile-a-model">Compile a model<a class="anchor" aria-label="anchor" href="#compile-a-model"></a>
</h4>
<p>If <code>cmdstan</code> is installed, the following example model
should work.</p>
<p>Set up data:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">cmdstan_path</span><span class="op">(</span><span class="op">)</span>, <span class="st">"examples"</span>, <span class="st">"bernoulli"</span>, <span class="st">"bernoulli.stan"</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Model executable is up to date!</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## data {</span></span>
<span><span class="co">##   int&lt;lower=0&gt; N;</span></span>
<span><span class="co">##   array[N] int&lt;lower=0,upper=1&gt; y;</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## parameters {</span></span>
<span><span class="co">##   real&lt;lower=0,upper=1&gt; theta;</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## model {</span></span>
<span><span class="co">##   theta ~ beta(1,1);  // uniform prior on interval 0,1</span></span>
<span><span class="co">##   y ~ bernoulli(theta);</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>Run a Monte Carlo Markov Chain:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># names correspond to the data block in the Stan program</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  parallel_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span></code></pre>
<p>Check that the model has successfully fitted by examining the model
parameters</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 2 × 10</span></span>
<span><span class="co">##   variable   mean median    sd   mad      q5    q95  rhat ess_bulk ess_tail</span></span>
<span><span class="co">##   &lt;chr&gt;     &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;  &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1 lp__     -7.26  -6.99  0.695 0.331 -8.70   -6.75   1.00    1661.    1619.</span></span>
<span><span class="co">## 2 theta     0.249  0.233 0.119 0.122  0.0816  0.468  1.00    1494.    1630.</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="run-a-model-using-brms">Run a model using brms<a class="anchor" aria-label="anchor" href="#run-a-model-using-brms"></a>
</h4>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">cmdstanr</span><span class="op">)</span></span>
<span><span class="fu">set_cmdstan_path</span><span class="op">(</span><span class="st">"C:/cmdstan"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Path not set. Can't find directory: C:/cmdstan</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>brms.backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">epilepsy</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling Stan program...</span></span></code></pre>
<pre><code>## 
-

\

|

/

-

\

|

/

-

\

|

/

-</code></pre>
<pre><code><span><span class="co">## In file included from /var/folders/80/x2f5bfts2_n9g_2h7w8rx3jm0000gn/T/RtmpGymuJf/model-5a0b7979b3af.hpp:1:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/src/stan/model/model_header.hpp:4:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math.hpp:19:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math/rev.hpp:10:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math/rev/fun.hpp:200:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math/prim/functor.hpp:16:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math/prim/functor/integrate_ode_rk45.hpp:6:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/stan/math/prim/functor/ode_rk45.hpp:9:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/numeric/odeint.hpp:76:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/numeric/odeint/integrate/observer_collection.hpp:23:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/function.hpp:30:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/function/detail/prologue.hpp:17:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/function/function_base.hpp:21:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/type_index.hpp:29:</span></span>
<span><span class="co">## In file included from /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/type_index/stl_type_index.hpp:47:</span></span>
<span><span class="co">## /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/container_hash/hash.hpp:132:33: warning: 'unary_function&lt;const std::error_category</span></span></code></pre>
<pre><code>## 
\</code></pre>
<pre><code><span><span class="co">## *, unsigned long&gt;' is deprecated [-Wdeprecated-declarations]</span></span>
<span><span class="co">##         struct hash_base : std::unary_function&lt;T, std::size_t&gt; {};</span></span>
<span><span class="co">##                                 ^</span></span>
<span><span class="co">## /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/container_hash/hash.hpp:692:18: note: in instantiation of template class 'boost::hash_detail::hash_base&lt;const std::error_category *&gt;' requested here</span></span>
<span><span class="co">##         : public boost::hash_detail::hash_base&lt;T*&gt;</span></span>
<span><span class="co">##                  ^</span></span>
<span><span class="co">## /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/container_hash/hash.hpp:420:24: note: in instantiation of template class 'boost::hash&lt;const std::error_category *&gt;' requested here</span></span>
<span><span class="co">##         boost::hash&lt;T&gt; hasher;</span></span>
<span><span class="co">##                        ^</span></span>
<span><span class="co">## /Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/boost_1.78.0/boost/container_hash/hash.hpp:551:9: note: in instantiation of function template specialization 'boost::hash_combine&lt;const std::error_category *&gt;' requested here</span></span>
<span><span class="co">##         hash_combine(seed, &amp;v.category());</span></span>
<span><span class="co">##         ^</span></span>
<span><span class="co">## /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1/__functional/unary_function.h:23:29: note: 'unary_function&lt;const std::error_category *, unsigned long&gt;' has been explicitly marked deprecated here</span></span>
<span><span class="co">## struct _LIBCPP_TEMPLATE_VIS _LIBCPP_DEPRECATED_IN_CXX11 unary_function</span></span>
<span><span class="co">##                             ^</span></span>
<span><span class="co">## /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1/__config:850:41: note: expanded from macro '_LIBCPP_DEPRECATED_IN_CXX11'</span></span>
<span><span class="co">## #    define _LIBCPP_DEPRECATED_IN_CXX11 _LIBCPP_DEPRECATED</span></span>
<span><span class="co">##                                         ^</span></span>
<span><span class="co">## /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1/__config:835:49: note: expanded from macro '_LIBCPP_DEPRECATED'</span></span>
<span><span class="co">## #      define _LIBCPP_DEPRECATED __attribute__((deprecated))</span></span>
<span><span class="co">##                                                 ^</span></span></code></pre>
<pre><code>## 
|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

\

|</code></pre>
<pre><code><span><span class="co">## 1 warning generated.</span></span></code></pre>
<pre><code>## 
/

-</code></pre>
<pre><code><span><span class="co">## ld: warning: duplicate -rpath '/Users/dbarneche/.cmdstan/cmdstan-2.33.1/stan/lib/stan_math/lib/tbb' ignored</span></span></code></pre>
<pre><code>## 
\

|

/

-

 
Running MCMC with 4 chains, at most 10 in parallel...
## 
## Chain 4 finished in 1.7 seconds.
## Chain 1 finished in 1.8 seconds.
## Chain 2 finished in 1.7 seconds.
## Chain 3 finished in 1.7 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 1.7 seconds.
## Total execution time: 1.9 seconds.</code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Family: poisson </span></span>
<span><span class="co">##   Links: mu = log </span></span>
<span><span class="co">## Formula: count ~ zAge + zBase * Trt + (1 | patient) </span></span>
<span><span class="co">##    Data: epilepsy (Number of observations: 236) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Group-Level Effects: </span></span>
<span><span class="co">## ~patient (Number of levels: 59) </span></span>
<span><span class="co">##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sd(Intercept)     0.58      0.07     0.46     0.73 1.01      793     1694</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Population-Level Effects: </span></span>
<span><span class="co">##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## Intercept      1.77      0.12     1.54     2.00 1.00      941     1752</span></span>
<span><span class="co">## zAge           0.09      0.09    -0.08     0.26 1.01      825     1493</span></span>
<span><span class="co">## zBase          0.70      0.12     0.46     0.93 1.01      723     1202</span></span>
<span><span class="co">## Trt1          -0.27      0.17    -0.58     0.06 1.00      847     1774</span></span>
<span><span class="co">## zBase:Trt1     0.05      0.17    -0.27     0.39 1.01      759     1316</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Burkner2017" class="csl-entry">
Bürkner, Paul Christian. 2017. <span>“<span class="nocase">brms: An R
package for Bayesian multilevel models using Stan</span>.”</span>
<em>Journal of Statistical Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-Burkner2018" class="csl-entry">
Bürkner, Paul-Christian. 2018. <span>“Advanced <span>Bayesian</span>
Multilevel Modeling with the <span>R</span> Package <span class="nocase">brms</span>.”</span> <em>The R Journal</em> 10 (1):
395–411. <a href="https://doi.org/10.32614/RJ-2018-017" class="external-link">https://doi.org/10.32614/RJ-2018-017</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rebecca Fisher, Diego R. Barneche, Gerard F. Ricardo, David R. Fox.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
