<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single model usage • bayesnec</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Single model usage">
<meta property="og:description" content="bayesnec">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example2b.html">Model details</a>
    </li>
    <li>
      <a href="../articles/example3.html">Priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
    <li>
      <a href="../articles/example5.html">Running `bayesnec`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/bayesnec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Single model usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/HEAD/vignettes/example1.Rmd" class="external-link"><code>vignettes/example1.Rmd</code></a></small>
      <div class="hidden name"><code>example1.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="bayesnec">
<code>bayesnec</code><a class="anchor" aria-label="anchor" href="#bayesnec"></a>
</h2>
<p>The <code>bayesnec</code> is an R package to fit concentration(dose)
— response curves to toxicity data, and derive No-Effect-Concentration
(<em>NEC</em>), No-Significant-Effect-Concentration (<em>NSEC</em>,
<span class="citation">(Fisher and Fox 2023)</span>), and
Effect-Concentration (of specified percentage “x”, <em>ECx</em>)
thresholds from non-linear models fitted using Bayesian Hamiltonian
Monte Carlo (HMC) via <code>brms</code> <span class="citation">(Paul
Christian Bürkner 2017; Paul-Christian Bürkner 2018)</span> and
<code>stan</code>. The package is an adaptation and extension of an
initial package <code>jagsNEC</code> <span class="citation">(Fisher,
Ricardo, and Fox 2020)</span> which was based on the <code>R2jags</code>
package <span class="citation">(Su and Yajima 2015)</span> and
<code>jags</code> <span class="citation">(Plummer 2003)</span>.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Bayesian model fitting can be difficult to automate across a broad
range of usage cases, particularly with respect to specifying valid
initial values and appropriate priors. This is one reason the use of
Bayesian statistics for <em>NEC</em> estimation (or even <em>ECx</em>
estimation) is not currently widely adopted across the broader
ecotoxicological community, who rarely have access to specialist
statistical expertise. The <code>bayesnec</code> package provides an
accessible interface specifically for fitting <em>NEC</em> models and
other concentration—response models using Bayesian methods. A range of
models are specified based on the known distribution of the
“concentration” or “dose” variable (the predictor) as well as the
“response” variable. The package requires a simplified model formula,
which together with the data is used to wrangle more complex non-linear
model formula(s), as well as to generate priors and initial values
required to call a <code>brms</code> model. While the distribution of
the predictor and response variables can be specified directly,
<code>bayesnec</code> will automatically attempt to assign the correct
distribution to use based on the characteristics of the provided
data.</p>
<p>This project started with an implementation of the <em>NEC</em> model
based on that described in (Pires et al. 2002) and <span class="citation">(Fox 2010)</span> using R2jags <span class="citation">(Fisher, Ricardo, and Fox 2020)</span>. The package has
been further generalised to allow a large range of response variables to
be modelled using the appropriate statistical distribution. While the
original <code>jagsNEC</code> implementation supported Gaussian-,
Poisson-, Binomial-, Gamma-, Negative Binomial- and Beta-distributed
response data, <code>bayesnec</code> additionally supports the
Beta-Binomial distribution, and can be easily extended to include any of
the available <code>brms</code> families. We have since also further
added a range of alternative <em>NEC</em> model types, as well as a
range of concentration—response models (such as 4-parameter logistic and
Weibull models) that are commonly used in frequentist-based packages
such as <code>drc</code><span class="citation">(Ritz et al.
2016)</span>. These models do not employ segmented linear regression
(i.e., use of a <code>step</code> function) but model the response as a
smooth function of concentration. They can be used to derive no-effect
toxicity estimates as a no-significant-effect-concentration <span class="citation">(Fisher and Fox 2023)</span>.</p>
<p>Specific models can be fit directly using <code>bnec</code>, which is
what we discuss here. Alternatively, it is possible to fit a custom
model set, a specific model set, or all the available models. Further
information on fitting multi-models using <code>bayesnec</code> can be
found in the <a href="https://open-aims.github.io/bayesnec/articles/example2.html" class="external-link">Multi
model usage</a> vignette. For detailed information on the models
available in <code>bayesnec</code> see the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model
details</a> vignette.</p>
<p>Important information on the current package is contained in the
<code>bayesnec</code> help-files and the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model
details</a> vignette.</p>
<p>This package is currently under development. We are keen to receive
any feedback regarding usage, and especially bug reporting that includes
an easy to run self-contained reproducible example of unexpected
behaviour, or example model fits that fail to converge (have poor chain
mixing) or yield other errors. Such information will hopefully help us
towards building a more robust package. We cannot help troubleshoot
issues if an easy-to-run reproducible example is not supplied.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install the latest release version from CRAN use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"bayesnec"</span><span class="op">)</span></span></code></pre></div>
<p>The current development version can be downloaded from GitHub via</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"open-aims/bayesnec"</span>, ref <span class="op">=</span> <span class="st">"dev"</span><span class="op">)</span></span></code></pre></div>
<p>Because <code>bayesnec</code> is based on <code>brms</code> and <a href="https://mc-stan.org/" class="external-link">Stan</a>, a C++ compiler is required. The
program <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> comes
with a C++ compiler for Windows. On Mac, you should install Xcode. See
the prerequisites section on this <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link">link</a>
for further instructions on how to get the compilers running.</p>
<p>To run this vignette, we will also need some additional packages</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="fitting-the-nec4param-model-using-bnec">Fitting the <code>nec4param</code> model using
<code>bnec</code><a class="anchor" aria-label="anchor" href="#fitting-the-nec4param-model-using-bnec"></a>
</h3>
<p>Here we include some examples showing how to use the package to fit
an <em>NEC</em> model to binomial, proportional, count and continuous
response data. The examples are those used at: <a href="https://github.com/gerard-ricardo/NECs/blob/master/NECs" class="external-link uri">https://github.com/gerard-ricardo/NECs/blob/master/NECs</a>,
but here we are showing how to fit models to these data using the
<code>bayesnec</code> package. Note however, the default behaviour in
<code>bayesnec</code> is to use the <code>"identity"</code> link because
the native link functions for each family (e.g., <code>"logit"</code>
for Binomial, <code>"log"</code> for Poisson) introduce non-linear
transformation on formulas which are already non-linear. So please be
aware that estimates of <em>NEC</em> or <em>ECx</em> might not be as
expected when using link functions other than identity (see the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model
details</a> vignette for more information and the models available in
<code>bayesnec</code>).</p>
<div class="section level4">
<h4 id="binomial-data">Binomial data<a class="anchor" aria-label="anchor" href="#binomial-data"></a>
</h4>
<p>The response variable is considered to follow a binomial distribution
when it is a count out of a total (such as the percentage survival of
individuals, for example). First, we read in the binomial example from
<a href="https://pastebin.com/tools" class="external-link">pastebin</a>, prepare the data for
analysis, and then inspect the dataset as well as the “concentration”,
in this case <code>raw_x</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/zfrUha88"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="va">raw.x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">binom_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    48 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ raw_x: num  0.1 0.1 0.1 0.1 0.1 0.1 6.25 6.25 6.25 6.25 ...</span></span>
<span><span class="co">#&gt;  $ suc  : int  101 106 102 112 58 158 95 91 93 113 ...</span></span>
<span><span class="co">#&gt;  $ tot  : int  175 112 103 114 69 165 109 92 99 138 ...</span></span>
<span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">binom_data</span><span class="op">$</span><span class="va">raw_x</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    0.10   10.94   37.50   99.23  125.00  400.00</span></span></code></pre></div>
<p>In this case for <code>raw_x</code>, lowest concentration is 0.1 and
the highest is 400. The data are right skewed and on the continuous
scale. This type of distribution for the predictor data are common for
concentration—response experiments, where the <em>concentration</em>
data are the concentration of contaminants, or dilutions. The current
default in <code>bayesnec</code> is to estimate the appropriate
distribution(s) and priors based on the data, but it is possible to
supply <code>prior</code> or <code>family</code> directly as additional
arguments to the underlying <code>brm</code> function from
<code>brms</code>. We are going to model this with the predictor data on
a log scale, as this is the scaling clearly used in the experimental
design and thus will provide more stable results.</p>
<p>The data are binomial, with the column <code>suc</code> indicating
the number of successes in the binomial call, and column
<code>tot</code> indicating the number of trials.</p>
<p>The main working function in <code>bayesnec</code> is the function
<code>bnec</code>, which calls the other necessary functions and fits
the <code>brms</code> model. We can run <code>bnec</code> by supplying
<code>formula</code>: a special formula which comprises the relationship
between response and predictor, and the C-R model (or models) chosen to
be fitted; and <code>data</code>: a <code>data.frame</code> containing
the data for the model fitting, here, <code>binom_data</code>.</p>
<p>The basic <code>bayesnec</code> formula should be of the form:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">suc</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tot</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"your_model"</span><span class="op">)</span></span></code></pre></div>
<p>where the left-hand side of the formula is implemented exactly as in
<code>brms</code>, including the <code>trials</code> term. The
right-hand side of the formula contains the special internal function
<code>crf</code> (which stands for concentration-response function), and
takes the predictor (including any simple function transformations such
as <code>log</code>) and the desired C-R model or suite of models. As
with any formula in R, the name of the terms need to be exactly as they
are in the input data.frame.</p>
<p><code>bnec</code> will guess the data types for use, although as
mentioned above we could manually specify <code>family</code> as
<code>"binomial"</code> (or <code>binomial</code>, or
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>). <code>bnec</code> will also generate
appropriate priors for the <code>brms</code> model call, although these
can also be specified manually (see the <a href="https://open-aims.github.io/bayesnec/articles/example3.html" class="external-link">Priors</a>
vignette for more details).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec/" class="external-link">bayesnec</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">suc</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tot</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">binom_data</span><span class="op">)</span></span></code></pre></div>
<p>The function shows the progress of the <code>brms</code> fit and
returns the usual <code>brms</code> output (with a few other elements
added to this list). The function <code>plot(pull_brmsfit(exp_1))</code>
can be used to plot the chains, so we can assess mixing and look for
other potential issues with the model fit. We can also run a pairs plot
that can help to assess issues with identifiability, and which also
looks OK. There are a range of other model diagnostics that can be
explored for <code>brms</code> model fits, using the function
<code>pull_brmsfit</code>. We encourage you to explore the rich material
already on GitHub regarding use and validation of <a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a> models.</p>
<p>Initially <code>bayesnec</code> will attempt to use starting values
generated for that type of model formula and family. It will run the
iterations and then test if all chains are valid. If the model does not
have valid chains <code>bayesnec</code> will discard that model and an
error will be returned indicating the model could not be fit
successfully.</p>
<p>Whenever the <code>model</code> argument of <code>crf</code> is a
single model <code>bnec</code> will return an object of class
<code>bayesnecfit</code>. We can see the summary of our fitted model
parameters using:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">exp_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class bayesnecfit containing the nec4param model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Family: binomial </span></span>
<span><span class="co">#&gt;   Links: mu = identity </span></span>
<span><span class="co">#&gt; Formula: suc | trials(tot) ~ bot + (top - bot) * exp(-exp(beta) * (log(raw_x) - nec) * step(log(raw_x) - nec)) </span></span>
<span><span class="co">#&gt;          bot ~ 1</span></span>
<span><span class="co">#&gt;          top ~ 1</span></span>
<span><span class="co">#&gt;          beta ~ 1</span></span>
<span><span class="co">#&gt;          nec ~ 1</span></span>
<span><span class="co">#&gt;    Data: data (Number of observations: 48) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 8000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Population-Level Effects: </span></span>
<span><span class="co">#&gt;      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; bot      0.05      0.02     0.02     0.08 1.00     3290     3189</span></span>
<span><span class="co">#&gt; top      0.83      0.01     0.81     0.84 1.00     4612     4519</span></span>
<span><span class="co">#&gt; beta     0.80      0.13     0.56     1.08 1.00     2899     3599</span></span>
<span><span class="co">#&gt; nec      4.42      0.03     4.36     4.48 1.00     3422     3996</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; NEC     4.42 4.36  4.48</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian R2 estimates:</span></span>
<span><span class="co">#&gt;    Estimate Est.Error Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; R2     0.81      0.00 0.80  0.82</span></span></code></pre></div>
<p>Note the Rhat values in this example are one, indicating
convergence.</p>
<p>The functions <code>plot</code> (extending <code>base</code> plot
method) and <code>autoplot</code> (extending <code>ggplot2</code> plot
method) can be used to plot the fitted model. You can also make your own
plot from the data included in the returned object (class
<code>bayesnecfit</code>) from the call to <code>bnec</code>.
<strong>Notice, however, that in this case we log-transformed the
predictor <code>raw_x</code> in the input formula.</strong> This causes
<code>brms</code> to pass these transformations onto Stan’s native code,
and therefore derived toxicity estimates will be on that same scale. So
we need to transform them back to the data scale using the additional
argument <code>xform</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_1</span>, xform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-binom-1.png" alt="plot of chunk exmp1-binom" width="60%"><p class="caption">
plot of chunk exmp1-binom
</p>
</div>
<p>There are many built in methods available for <code>brmsfit</code>
objects and we encourage you to make use of these in full.</p>
<p>This model fit does not look great. You can see that the error bounds
around the fit are far too narrow for this data given the variability
among the points, suggesting over dispersion of this model (meaning that
the data are more variable than this model fit predicts). For models
whose response data are Binomial- or Poisson-distributed, an estimate of
dispersion is provided by <code>bayesnec</code>, and this can be
extracted using <code>exp_1$dispersion</code>. Values &gt; 1 indicate
overdispersion and values &lt; 1 indicate underdispersion. In this case
the overdispersion value is much bigger than 1, suggesting extreme
overdispersion (meaning our model does not properly capture the true
variability represented in this data). We would need to consider
alternative ways of modelling this data using a different distribution,
such as the Beta-Binomial.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_1</span><span class="op">$</span><span class="va">dispersion</span></span>
<span><span class="co">#&gt; Estimate     Q2.5    Q97.5 </span></span>
<span><span class="co">#&gt; 19.63764 13.17076 31.03416</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="beta-binomial">Beta-Binomial<a class="anchor" aria-label="anchor" href="#beta-binomial"></a>
</h4>
<p>The Beta-Binomial model can be useful for overdispersed Binomial
data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">suc</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tot</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">binom_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsfamily.html" class="external-link">beta_binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Fitting this data with the <code>beta_binomial</code> yields a much
more realistic fit in terms of the confidence bounds (check
<code>autoplot(exp_1b, xform = exp)</code>) and the spread in the data.
Note that a dispersion estimate is not provided here, as overdispersion
is only relevant for Poisson and Binomial data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_1b</span>, xform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-bbinom-1.png" alt="plot of chunk exmp1-bbinom" width="60%"><p class="caption">
plot of chunk exmp1-bbinom
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_1b</span><span class="op">$</span><span class="va">dispersion</span></span>
<span><span class="co">#&gt; [1] NA NA NA</span></span></code></pre></div>
<p>Now that we have a better fit to these data, we can interpret the
results. The estimated <em>NEC</em> value can be obtained directly from
the fitted model object. As explained above, we need to transform
<em>NEC</em> back to the data scale.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">exp_1b</span><span class="op">$</span><span class="va">ne_posterior</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   16.78   65.59   79.40   76.98   89.56  191.07</span></span></code></pre></div>
<p>EC<em>x</em> estimates can also be obtained from the <em>NEC</em>
model fit, using the function <code>ecx</code>. Note these may differ
from a typical 4-parameter non-linear model, as the <em>NEC</em> model
is a broken stick non-linear regression and will often fall more sharply
than a smooth 4-parameter non-linear curve. See both the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model
details</a> and <a href="https://open-aims.github.io/bayesnec/articles/example4.html" class="external-link">Comparing
posterior predictions</a> vignettes for more information.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ecx.html">ecx</a></span><span class="op">(</span><span class="va">exp_1b</span>, xform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Q50     Q2.5    Q97.5 </span></span>
<span><span class="co">#&gt; 83.76276 42.93213 99.77477 </span></span>
<span><span class="co">#&gt; attr(,"resolution")</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; attr(,"ecx_val")</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; attr(,"toxicity_estimate")</span></span>
<span><span class="co">#&gt; [1] "ecx"</span></span></code></pre></div>
<p>A summary method has also been developed for <code>bayesnecfit</code>
objects that gives an overall summary of the model statistics, which
also include the estimate for <em>NEC</em>, as the
<code>nec_intercept</code> population-level effect in the model—again,
its value will depend on the scale of the predictor variable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">exp_1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class bayesnecfit containing the nec4param model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Family: beta_binomial </span></span>
<span><span class="co">#&gt;   Links: mu = identity; phi = identity </span></span>
<span><span class="co">#&gt; Formula: suc | trials(tot) ~ bot + (top - bot) * exp(-exp(beta) * (log(raw_x) - nec) * step(log(raw_x) - nec)) </span></span>
<span><span class="co">#&gt;          bot ~ 1</span></span>
<span><span class="co">#&gt;          top ~ 1</span></span>
<span><span class="co">#&gt;          beta ~ 1</span></span>
<span><span class="co">#&gt;          nec ~ 1</span></span>
<span><span class="co">#&gt;    Data: data (Number of observations: 48) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 8000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Population-Level Effects: </span></span>
<span><span class="co">#&gt;      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; bot      0.13      0.06     0.03     0.23 1.01      517     1961</span></span>
<span><span class="co">#&gt; top      0.84      0.03     0.78     0.89 1.04       91       25</span></span>
<span><span class="co">#&gt; beta     0.86      0.75    -0.21     4.09 1.02      153       76</span></span>
<span><span class="co">#&gt; nec      4.37      0.21     3.66     4.62 1.02      163       80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family Specific Parameters: </span></span>
<span><span class="co">#&gt;     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; phi     5.43      1.18     3.32     8.23 1.01     1731     3682</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; NEC     4.37 3.66  4.62</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian R2 estimates:</span></span>
<span><span class="co">#&gt;    Estimate Est.Error Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; R2     0.77      0.04 0.67  0.81</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="beta-data">Beta data<a class="anchor" aria-label="anchor" href="#beta-data"></a>
</h4>
<p>Sometimes the response variable is distributed between <code>0</code>
and <code>1</code> but is not a straight-forward Binomial because it is
a proportion on the continuous scale. A common example in coral ecology
is maximum quantum yield (the proportion of light used for
photosynthesis when all reaction centres are open) which is a measure of
photosynthetic efficiency calculated from Pulse-Amplitude-Modulation
(PAM) data. Here we have a proportion value that is not based on trials
and successes. In this case there are no theoretical trials, and the
data must be modelled using a Beta distribution instead.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prop_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/123jq46d"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="va">raw.x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">raw_x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">prop_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_2</span>, xform <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-beta-1.png" alt="plot of chunk exmp1-beta" width="60%"><p class="caption">
plot of chunk exmp1-beta
</p>
</div>
</div>
<div class="section level4">
<h4 id="poisson-data">Poisson data<a class="anchor" aria-label="anchor" href="#poisson-data"></a>
</h4>
<p>Where data are a count (of, for example, individuals or cells), the
response is likely to be Poisson distributed. Such data are distributed
from <code>0</code> to <code>Inf</code> and are integers. First we mimic
count data based on the package’s internal dataset, and make it
overdispersed. Then we plot the concentration (i.e. predictor) data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span></span>
<span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="va">nec_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="op">(</span><span class="va">y</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    100 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ x: num  1.019 0.816 0.371 0.401 1.295 ...</span></span>
<span><span class="co">#&gt;  $ y: int  76 95 94 102 91 82 93 82 111 102 ...</span></span>
<span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    4.00   70.50   87.50   79.84   97.00  121.00</span></span>
<span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt; 0.03235 0.43424 0.87599 1.05142 1.59336 3.22052</span></span></code></pre></div>
<p>First, we supply <code>bnec</code> with <code>data</code> (here
<code>count_data</code>), and specify our formula. As we have integers
of 0 and greater, the <code>family</code> is <code>"poisson"</code>. The
default behaviour to guess the variable types works for this
example.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">count_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_3</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-poisson-1.png" alt="plot of chunk exmp1-poisson" width="60%"><p class="caption">
plot of chunk exmp1-poisson
</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_3</span><span class="op">$</span><span class="va">dispersion</span></span>
<span><span class="co">#&gt;    Estimate        Q2.5       Q97.5 </span></span>
<span><span class="co">#&gt;   3.7361984   0.4501145 114.1585737</span></span></code></pre></div>
<p>We first plot the model chains (with <code>plot(exp_3$fit)</code>)
and parameter estimates to check the fit. The chains look OK. However,
our plot of the fit is not very convincing. The model uncertainty is
very narrow, and this does not seem to be a particularly good model for
these data. Note that the dispersion estimate is much greater than one,
indicating serious overdispersion. In this case we can try to refit the
model but instead deliberately specifying the Negative Binomial
distribution for via the <code>family</code> argument.</p>
</div>
<div class="section level4">
<h4 id="negative-binomial">Negative binomial<a class="anchor" aria-label="anchor" href="#negative-binomial"></a>
</h4>
<p>When count data are overdispersed and cannot be modelled using the
Poisson distribution, the Negative binomial distribution is generally
used. We can do this by calling <code>family = "negbinomial"</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">count_data</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"negbinomial"</span><span class="op">)</span></span></code></pre></div>
<p>The resultant plot seems to indicate the Negative Binomial
distribution works better in terms of dispersion (more sensible wider
confidence bands), however it still might not be the best model for
these data. See the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model
details</a> and <a href="https://open-aims.github.io/bayesnec/articles/example2.html" class="external-link">Multi
model usage</a> vignettes for options to fit other models to these
data.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_3b</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-negbinbase-1.png" alt="plot of chunk exmp1-negbinbase" width="60%"><p class="caption">
plot of chunk exmp1-negbinbase
</p>
</div>
</div>
<div class="section level4">
<h4 id="measure-data">Measure data<a class="anchor" aria-label="anchor" href="#measure-data"></a>
</h4>
<p>Where data are a measured variable, the response is likely to be
Gamma distributed. Good examples of <code>Gamma</code>-distributed data
include measures of body size, such as length, weight, or area. Such
data are distributed from <code>0+</code> to <code>Inf</code> and are
continuous. Here we use the <code>nec_data</code> supplied with
<code>bayesnec</code> with the response <code>y</code> on the
exponential scale to ensure the right data range for a Gamma as an
example.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span></span>
<span><span class="va">measure_data</span> <span class="op">&lt;-</span> <span class="va">nec_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">exp_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span><span class="va">measure</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">measure_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">exp_4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="vignette-fig-exmp1-gammabase-1.png" alt="plot of chunk exmp1-gammabase" width="60%"><p class="caption">
plot of chunk exmp1-gammabase
</p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">exp_4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class bayesnecfit containing the nec4param model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Family: gamma </span></span>
<span><span class="co">#&gt;   Links: mu = identity; shape = identity </span></span>
<span><span class="co">#&gt; Formula: measure ~ bot + (top - bot) * exp(-exp(beta) * (x - nec) * step(x - nec)) </span></span>
<span><span class="co">#&gt;          bot ~ 1</span></span>
<span><span class="co">#&gt;          top ~ 1</span></span>
<span><span class="co">#&gt;          beta ~ 1</span></span>
<span><span class="co">#&gt;          nec ~ 1</span></span>
<span><span class="co">#&gt;    Data: data (Number of observations: 100) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 8000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Population-Level Effects: </span></span>
<span><span class="co">#&gt;      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; bot      0.98      0.05     0.88     1.07 1.00     3792     4259</span></span>
<span><span class="co">#&gt; top      2.44      0.01     2.41     2.46 1.00     6864     5002</span></span>
<span><span class="co">#&gt; beta     0.65      0.10     0.46     0.84 1.00     3201     3628</span></span>
<span><span class="co">#&gt; nec      1.50      0.02     1.46     1.54 1.00     4087     4834</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family Specific Parameters: </span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; shape   513.56     73.53   382.67   681.22 1.00     6410     5039</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; NEC     1.50 1.46  1.54</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian R2 estimates:</span></span>
<span><span class="co">#&gt;    Estimate Est.Error Q2.5 Q97.5</span></span>
<span><span class="co">#&gt; R2     0.95      0.00 0.94  0.95</span></span></code></pre></div>
<p>In this case our model has converged really well.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Burkner2017" class="csl-entry">
Bürkner, Paul Christian. 2017. <span>“<span class="nocase">brms: An R
package for Bayesian multilevel models using Stan</span>.”</span>
<em>Journal of Statistical Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-Burkner2018" class="csl-entry">
Bürkner, Paul-Christian. 2018. <span>“Advanced <span>Bayesian</span>
Multilevel Modeling with the <span>R</span> Package <span class="nocase">brms</span>.”</span> <em>The R Journal</em> 10 (1):
395–411. <a href="https://doi.org/10.32614/RJ-2018-017" class="external-link">https://doi.org/10.32614/RJ-2018-017</a>.
</div>
<div id="ref-fisherfox2023" class="csl-entry">
Fisher, Rebecca, and David R Fox. 2023. <span>“Introducing the No
Significant Effect Concentration <span>(NSEC)</span>.”</span> Journal
Article. <em>Environmental Toxicology and Chemistry</em> 42 (9):
2019–28. https://doi.org/<a href="https://doi.org/10.1002/etc.5610" class="external-link">https://doi.org/10.1002/etc.5610</a>.
</div>
<div id="ref-Fisher2020" class="csl-entry">
Fisher, Rebecca, Gerard Ricardo, and David Fox. 2020. <span>“<span class="nocase">Bayesian concentration-response modelling using
jagsNEC</span>.”</span> <a href="https://doi.org/10.5281/ZENODO.3966864" class="external-link">https://doi.org/10.5281/ZENODO.3966864</a>.
</div>
<div id="ref-Fox2010" class="csl-entry">
Fox, David R. 2010. <span>“<span class="nocase">A Bayesian approach for
determining the no effect concentration and hazardous concentration in
ecotoxicology</span>.”</span> <em>Ecotoxicology and Environmental
Safety</em> 73 (2): 123–31.
</div>
<div id="ref-Plummer2003" class="csl-entry">
Plummer, Martyn. 2003. <span>“<span class="nocase">JAGS: A program for
analysis of Bayesian graphical models using Gibbs
sampling</span>.”</span> In <em><span class="nocase">Proceedings of the
3rd International Workshop on Distributed Statistical Computing (DSC
2003)</span></em>, 1–10. Technische Universität Wien, Vienna, Austria:
Achim Zeileis.
</div>
<div id="ref-Ritz2016" class="csl-entry">
Ritz, Christian, Florent Baty, Jens C Streibig, and Daniel Gerhard.
2016. <span>“<span>Dose-Response Analysis Using R</span>.”</span>
<em>PLoS ONE</em> 10 (12): e0146021. <a href="https://doi.org/10.1371/journal.pone.0146021" class="external-link">https://doi.org/10.1371/journal.pone.0146021</a>.
</div>
<div id="ref-Su2015" class="csl-entry">
Su, Yu-Sung, and Masanao Yajima. 2015. <em><span class="nocase">R2jags:
Using R to Run ’JAGS’</span></em>. <a href="https://CRAN.R-project.org/package=R2jags" class="external-link">https://CRAN.R-project.org/package=R2jags</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
