<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single model usage • bayesnec</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Single model usage">
<meta property="og:description" content="bayesnec">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example2b.html">Model details</a>
    </li>
    <li>
      <a href="../articles/example3.html">Priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/bayesnec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example1_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Single model usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/master/vignettes/example1.Rmd" class="external-link"><code>vignettes/example1.Rmd</code></a></small>
      <div class="hidden name"><code>example1.Rmd</code></div>

    </div>

    
    
<div id="bayesnec" class="section level1">
<h1 class="hasAnchor">
<a href="#bayesnec" class="anchor" aria-hidden="true"></a><code>bayesnec</code>
</h1>
<p>The <code>bayesnec</code> is an R package to fit concentration(dose) — response curves to toxicity data, and derive No-Effect-Concentration (<em>NEC</em>), No-Significant-Effect-Concentration (<em>NSEC</em>), and Effect-Concentration (of specified percentage ‘x’, <em>ECx</em>) thresholds from non-linear models fitted using Bayesian MCMC fitting methods via <code>brms</code> <span class="citation">(Bürkner 2017; Bürkner 2018)</span> and <code>stan</code>. The package is an adaptation and extension of an initial package <code>jagsNEC</code> <span class="citation">(Fisher, Ricardo, and Fox 2020)</span> which was based on the <code>R2jags</code> package <span class="citation">(Su and Yajima 2015)</span> and <code>jags</code> <span class="citation">(Plummer 2003)</span>.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor" aria-hidden="true"></a>Background</h1>
<p>Bayesian model fitting can be difficult to automate across a broad range of usage cases, particularly with respect to specifying valid initial values and appropriate priors. This is one reason the use of Bayesian statistics for <em>NEC</em> estimation (or even <em>ECx</em> estimation) is not currently widely adopted across the broader ecotoxicological community, who rarely have access to specialist statistical expertise. The <code>bayesnec</code> package provides an accessible interface specifically for fitting <em>NEC</em> models and other concentration—response models using Bayesian methods. A range of models are specified based on the known distribution of the “concentration” or “dose” variable (the predictor, x) as well as the “response” (y) variable. The model formula, including priors and initial values required to call a <code>brms</code> model are automatically generated based on information contained in the supplied data. While the distribution of the x and y variables can be specified directly, <code>bayesnec</code> will automatically ‘guess’ the correct distribution to use based on the characteristics of the provided data.</p>
<p>This project started with an implementation of the <em>NEC</em> model based on that described in (Pires et al. 2002) and <span class="citation">(Fox 2010)</span> using R2jags <span class="citation">(Fisher, Ricardo, and Fox 2020)</span>. The package has been further generalised to allow a large range of response variables to be modelled using the appropriate statistical distribution. While the original <code>jagsNEC</code> implementation supported Gaussian, Poisson, Binomial, Gamma, Negative Binomial and beta response data <code>bayesnec</code> additionally supports the Beta-Binomial distribution, and can be easily extended to include any of the available <code>brms</code> families. We have since also further added a range of alternative <em>NEC</em> model types, as well as a range of concentration—response models (such as 4-parameter logistic and Weibull models) that are commonly used in frequentist packages such as <code>drc</code><span class="citation">(Ritz et al. 2016)</span>. These models do not employ segmented regression (i.e., use of a ‘step’ function) but simply models the response as a smooth function of concentration.</p>
<p>Specific models can be fit directly using <code>bnec</code>, which is what we discuss here. Alternatively, it is possible to fit a custom model set, a specific model set, or all the available models. Further information on fitting multi-models using <code>bayesnec</code> can be found in the <a href="https://open-aims.github.io/bayesnec/articles/example2.html" class="external-link">Multi model usage</a> vignette. For detailed information on the models available in <code>bayesnec</code> see the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> vignette.</p>
<p>Important information on the current package is contained in the <code>bayesnec</code> help-files and the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> vignette.</p>
<p>This package is currently under development. We are keen to receive any feedback regarding usage, and especially bug reporting that includes an easy to run self-contained reproducible example of unexpected behaviour, or example model fits that fail to converge (have poor chain mixing) or yield other errors. Such information will hopefully help us towards building a more robust package. We cannot help troubleshoot issues if an easy-to-run reproducible example is not supplied.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor" aria-hidden="true"></a>Installation</h1>
<p>To install the latest release version from CRAN use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"bayesnec"</span><span class="op">)</span></code></pre></div>
<p>The current development version can be downloaded from GitHub via</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"open-aims/bayesnec"</span><span class="op">)</span></code></pre></div>
<p>Because <code>bayesnec</code> is based on <code>brms</code> and <a href="https://mc-stan.org/" class="external-link">Stan</a>, a C++ compiler is required. The program <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> comes with a C++ compiler for Windows. On Mac, you should install Xcode. See the prerequisites section on this <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link">link</a> for further instructions on how to get the compilers running.</p>
<p>To run this vignette, we will also need some additional packages</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor" aria-hidden="true"></a>Examples</h1>
<div id="fitting-the-neclin-model-using-bnec" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-neclin-model-using-bnec" class="anchor" aria-hidden="true"></a>Fitting the neclin model using <code>bnec</code>
</h2>
<p>Here we include some examples showing how to use the package to fit an <em>NEC</em> model to binomial, proportional, count and continuous response (y) data. The examples are those used at: <a href="https://github.com/gerard-ricardo/NECs/blob/master/NECs" class="external-link uri">https://github.com/gerard-ricardo/NECs/blob/master/NECs</a>, but here we are showing how to fit models to these data using the <code>bayesnec</code> package. Note however, the default behaviour in <code>bayesnec</code> is to use native link functions for each family, thus we fit the “neclin” model for these examples, rather than the “nec3param” model which is not valid for use with the logit or log link (see the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> vignette for more information and the models available in <code>bayesnec</code>).</p>
<div id="binomial-data" class="section level3">
<h3 class="hasAnchor">
<a href="#binomial-data" class="anchor" aria-hidden="true"></a>Binomial data</h3>
<p>The response variable <code>y</code> is considered to follow a binomial distribution when it is a count out of a total (such as the percentage survival of individuals, for example). First, we read in the binomial example from <a href="https://pastebin.com/tools" class="external-link">pastebin</a>, prepare the data for analysis, and then inspect the dataset as well as the “concentration” or x variable, in this case <code>raw_x</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binom_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/zfrUha88"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="va">raw.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span>,
                log_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">binom_data</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    48 obs. of  4 variables:</span>
<span class="co">#&gt;  $ raw_x: num  0.1 0.1 0.1 0.1 0.1 0.1 6.25 6.25 6.25 6.25 ...</span>
<span class="co">#&gt;  $ suc  : int  101 106 102 112 58 158 95 91 93 113 ...</span>
<span class="co">#&gt;  $ tot  : int  175 112 103 114 69 165 109 92 99 138 ...</span>
<span class="co">#&gt;  $ log_x: num  -2.3 -2.3 -2.3 -2.3 -2.3 ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">binom_data</span><span class="op">$</span><span class="va">raw_x</span><span class="op">)</span>
<span class="co">#&gt; [1]   0.1 400.0</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">binom_data</span><span class="op">$</span><span class="va">raw_x</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="100%"></p>
<p>In this case for x, lowest concentration is 0.1 and the highest is 400. The data are right skewed and on the continuous scale. This type of distribution for the x data are common for concentration—response experiments, where the x ‘concentration’ data are the concentration of contaminants, or dilutions. The current default in <code>bayesnec</code> is to estimate the appropriate distribution(s) and priors for the <code>family</code> argument, but it is possible to supply <code>family</code> directly. We are going to model this with the x data on a log scale, as this is the scaling clearly used in the experimental design and thus will provide more stable results.</p>
<p>The data are clearly binomial, with the column <code>suc</code>—indicating the number of ‘successes’ in the binomial call, with <code>tot</code> clearly indicating the number of trials.</p>
<p>The main ‘working’ function in <code>bayesnec</code> is the function <code>bnec</code>, which calls the other necessary functions and fits the <code>brms</code> model. We run <code>bnec</code> by supplying <code>data</code>: a data.frame containing the data for the model fitting, here, <code>binom_data</code>; <code>x_var</code>: the name of the column in <code>data</code> which contains the concentration data or ‘x’ data to be used in the <em>NEC</em> model fit, and <code>y_var</code>: the name of the column in <code>data</code> which contains the response or ‘y’ data to be used in the <em>NEC</em> model fit. In our example here, as this is binomial, we must also supply <code>trials_var</code>, which is the name of the column in <code>data</code> which contains the number of trials in the binomial call.</p>
<p><code>bnec</code> will guess the data types for use, although as mentioned above we could manually specify <code>family</code> as “binomial”. <code>bnec</code> will also generate appropriate priors for the <code>brms</code> model call, although these can also be specified manually (see the <a href="https://open-aims.github.io/bayesnec/articles/example3.html" class="external-link">Priors</a> vignette for more details).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec/" class="external-link">bayesnec</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">binom_data</span>, x_var <span class="op">=</span> <span class="st">"log_x"</span>,
              y_var <span class="op">=</span> <span class="st">"suc"</span>, model <span class="op">=</span> <span class="st">"neclin"</span>,
              trials_var <span class="op">=</span> <span class="st">"tot"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8a8b3e9e9e97704abf746e2c6f5cd369' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 7.2e-05 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.72 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 1.31598 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.172262 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                1.48824 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8a8b3e9e9e97704abf746e2c6f5cd369' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 2.4e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.24 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 1.31395 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.180111 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                1.49406 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8a8b3e9e9e97704abf746e2c6f5cd369' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 2.5e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.25 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 1.31919 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.191825 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                1.51101 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8a8b3e9e9e97704abf746e2c6f5cd369' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 2.5e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.25 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 1.30727 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.187053 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                1.49433 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<p>The function shows the progress of the <code>brms</code> fit and returns the usual <code>brms</code> output (with a few other elements added to this list). The function <code>plot(exp_1$fit)</code> can be used to plot the chains, so we can assess mixing and look for other potential issues with the model fit. Initially <code>bayesnec</code> will attempt to use starting values generated for that type of model formula and family. It will run the iterations and then test if all chains are valid. If the model does not have valid chains <code>bayesnec</code> with try up to <code>n_tries</code> more times to fit the data using either <code>bayesnec</code> generated or <code>brms</code> default initial values and obtain a successfully fitted model with good mixing. If no model is successfully fit an error will be returned indicating the model could not be fit successfully.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="100%"></p>
<p>In our example, the chains are well mixed, and the probability density plots look good. We can also run a pairs plot that can help to assess issues with identifiability, and which also looks ok. There are a range of other model diagnostics that can be explored for [brms] model fits, using the $fit syntax. We encourage you to explore the rich material already on github regarding use and validation of [brms] (<a href="https://github.com/paul-buerkner/brms" class="external-link uri">https://github.com/paul-buerkner/brms</a>) models.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">exp_1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-7-1.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" width="100%"></p>
<p>We can see the summary of our fitted model parameters using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">exp_1</span><span class="op">)</span>
<span class="co">#&gt; Object of class bayesnecfit containing the following non-linear model: neclin</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Family: binomial </span>
<span class="co">#&gt;   Links: mu = logit </span>
<span class="co">#&gt; Formula: y | trials(trials) ~ top - exp(slope) * (x - nec) * step(x - nec) </span>
<span class="co">#&gt;          top ~ 1</span>
<span class="co">#&gt;          slope ~ 1</span>
<span class="co">#&gt;          nec ~ 1</span>
<span class="co">#&gt;    Data: structure(list(x = c(-2.30258509299405, -2.3025850 (Number of observations: 48) </span>
<span class="co">#&gt; Samples: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup samples = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; top_Intercept       1.69      0.05     1.59     1.80 1.00     1928     1457</span>
<span class="co">#&gt; slope_Intercept     0.66      0.04     0.58     0.73 1.00     1272     1284</span>
<span class="co">#&gt; nec_Intercept       3.72      0.06     3.60     3.82 1.00     1186     1040</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Note the Rhat values in this example are one, indicating convergence.</p>
<p>The function <code>plot</code> can be used to plot the fitted model. You can also make your own plot from the data included in the returned <code>bayesnecfit</code> object from the call to <code>bnec</code>. Here we use the default plot method from <code>bayesnec</code>, where we add the ‘exp’ function to plot the tick labels on the original scaling of the concentration data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_1</span>, lxform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" width="100%"></p>
<p>Alternatively, we can use the built in <code>brms</code> methods to plot the <code>brms</code> fit directly. For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">exp_1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">y</span> <span class="op">/</span> <span class="va">trials</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/conditional_effects.brmsfit.html" class="external-link">conditional_effects</a></span><span class="op">(</span><span class="va">exp_1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">prop</span><span class="op">)</span>,
                inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-10-1.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" width="100%"><img src="vignette-fig-unnamed-chunk-10-2.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" width="100%"></p>
<p>This model fit doesn’t look great. You can see that the error bounds around the fit are far too narrow for this data, suggesting over dispersion of this model (meaning that the data are more variable than this model fit predicts). An estimate of dispersion is provided by <code>bayesnec</code>, and this can be extracted using <code>exp_1$dispersion</code>. Values &gt;1 indicate overdispersion and values &lt;1 indicate underdispersion. In this case the overdispersion value is much bigger than 1, suggesting extreme overdispersion (meaning our model doesn’t properly capture the true variability represented in this data). We would need to consider alternative ways of modelling this data using a different distribution, such as the Beta-Binomial.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_1</span><span class="op">$</span><span class="va">dispersion</span>
<span class="co">#&gt; Estimate     Q2.5    Q97.5 </span>
<span class="co">#&gt; 19.51379 13.07776 30.61626</span></code></pre></div>
</div>
<div id="beta-binomial" class="section level3">
<h3 class="hasAnchor">
<a href="#beta-binomial" class="anchor" aria-hidden="true"></a>Beta-Binomial</h3>
<p>The Beta-Binomial model can be useful for overdispersed Binomial data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">binom_data</span>, x_var <span class="op">=</span> <span class="st">"log_x"</span>,
               y_var <span class="op">=</span> <span class="st">"suc"</span>, model <span class="op">=</span> <span class="st">"neclin"</span>,
               family <span class="op">=</span> <span class="va">beta_binomial2</span>,
               trials_var <span class="op">=</span> <span class="st">"tot"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'dbe470e6d8427b0eb0462767407ead75' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 6.2e-05 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.62 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 3.36142 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.413773 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                3.7752 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'dbe470e6d8427b0eb0462767407ead75' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 4e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.4 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 3.3744 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.451995 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                3.8264 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'dbe470e6d8427b0eb0462767407ead75' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 3.9e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.39 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 3.39203 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.433083 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                3.82511 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'dbe470e6d8427b0eb0462767407ead75' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 3.7e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.37 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 3.3576 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.460912 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                3.81851 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<p>Fitting this data with the betabinomial2 yields a much more realistic fit in terms of the confidence bounds and the spread in the data. Note that a dispersion estimate is not provided here, as overdispersion is only relevant for Poisson and Binomial data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_1b</span>, lxform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_1b</span><span class="op">$</span><span class="va">dispersion</span>
<span class="co">#&gt; [1] NA NA NA</span></code></pre></div>
<p>Now we have a good fit to these data, we can interpret the results. The estimated <em>NEC</em> value can be obtained directly from the fitted model object, using <code>exp_1b$nec</code>, or we can plot the posterior distribution of the <em>NEC</em> values.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_1b</span><span class="op">$</span><span class="va">nec</span>
<span class="co">#&gt; Estimate     Q2.5    Q97.5 </span>
<span class="co">#&gt; 3.483277 2.703967 4.070901</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">exp_1b</span><span class="op">$</span><span class="va">nec_posterior</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-14-1.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" width="100%"></p>
<p>EC<em>x</em> estimates can also be obtained from the <em>NEC</em> model fit, using the function <code>ecx</code>. Note these may differ from a typical 4-parameter non-linear model, as the <em>NEC</em> model is a broken stick non-linear regression and will often fall more sharply than a smooth 4-parameter non-linear curve. See both the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> and <a href="https://open-aims.github.io/bayesnec/articles/example4.html" class="external-link">Comparing posterior predictions</a> vignettes for more information.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ecx.html">ecx</a></span><span class="op">(</span><span class="va">exp_1b</span><span class="op">)</span>
<span class="co">#&gt;   ec_10_Q50  ec_10_Q2.5 ec_10_Q97.5 </span>
<span class="co">#&gt;    3.849458    3.301503    4.314389 </span>
<span class="co">#&gt; attr(,"precision")</span>
<span class="co">#&gt; [1] 1000</span></code></pre></div>
<p>A summary method has also been developed for <code>bayesnecfit</code> objects that gives an overall summary of the model statistics, which also include the estimate for <strong>NEC</strong>, as the nec_intercept population level effect in the model.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">exp_1b</span><span class="op">)</span>
<span class="co">#&gt; Object of class bayesnecfit containing the following non-linear model: neclin</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Family: beta_binomial2 </span>
<span class="co">#&gt;   Links: mu = logit; phi = identity </span>
<span class="co">#&gt; Formula: y | trials(trials) ~ top - exp(slope) * (x - nec) * step(x - nec) </span>
<span class="co">#&gt;          top ~ 1</span>
<span class="co">#&gt;          slope ~ 1</span>
<span class="co">#&gt;          nec ~ 1</span>
<span class="co">#&gt;    Data: structure(list(x = c(-2.30258509299405, -2.3025850 (Number of observations: 48) </span>
<span class="co">#&gt; Samples: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup samples = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; top_Intercept       1.82      0.23     1.37     2.28 1.00     1665     1908</span>
<span class="co">#&gt; slope_Intercept     0.46      0.18     0.07     0.80 1.00     1836     1954</span>
<span class="co">#&gt; nec_Intercept       3.48      0.31     2.70     4.07 1.00     1735     1590</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; phi     5.78      1.34     3.65     8.90 1.00     1786     2248</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
</div>
<div id="beta-data" class="section level3">
<h3 class="hasAnchor">
<a href="#beta-data" class="anchor" aria-hidden="true"></a>Beta data</h3>
<p>Sometimes the response variable is distributed between <code>0</code> and <code>1</code> but is not a straight-forward Binomial. A common example in coral ecology is maximum quantum yield (the proportion of light used for photosynthesis when all reaction centres are open) which is a measure of photosynthetic efficiency calculated from PAM data. Here we have a proportion value that is not based on trials and successes. In this case there are no theoretical ‘trials’ and the data must be modelled using a beta distribution.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prop_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/123jq46d"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="va">raw.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,
                resp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">prop_data</span>, x_var <span class="op">=</span> <span class="st">"raw_x"</span>,
              y_var <span class="op">=</span> <span class="st">"resp"</span>, model <span class="op">=</span> <span class="st">"neclin"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8bac138c9ef2061a5ea735609fd6ea64' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 0.000101 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.01 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 6.27707 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.85706 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                7.13413 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8bac138c9ef2061a5ea735609fd6ea64' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 5.9e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.59 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 6.07363 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.941764 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                7.01539 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8bac138c9ef2061a5ea735609fd6ea64' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 5.7e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.57 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 5.95139 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.876905 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                6.82829 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '8bac138c9ef2061a5ea735609fd6ea64' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 6.6e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.66 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 5.92945 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.802549 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                6.732 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_2</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-18-1.png" title="plot of chunk unnamed-chunk-18" alt="plot of chunk unnamed-chunk-18" width="100%"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-19-1.png" title="plot of chunk unnamed-chunk-19" alt="plot of chunk unnamed-chunk-19" width="100%"></p>
</div>
<div id="poisson-data" class="section level3">
<h3 class="hasAnchor">
<a href="#poisson-data" class="anchor" aria-hidden="true"></a>Poisson data</h3>
<p>Where data are a count (of, for example, individuals or cells) y is Poisson. Such data are distributed from <code>0</code> to <code>Inf</code> and are integers. First we read in the count data example from <a href="https://pastebin.com/tools" class="external-link">pastebin</a>, and then plot the “concentration” or x data, Again, this is <code>raw_x</code>, and distributed as in our binomial example above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/ENgNSgf7"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="va">raw.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>raw_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span>,
                sqrt_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">raw_x</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    48 obs. of  3 variables:</span>
<span class="co">#&gt;  $ raw_x : num  0.1 0.1 0.1 0.1 0.1 0.1 9.67 9.67 9.67 9.67 ...</span>
<span class="co">#&gt;  $ count : int  164 100 103 102 102 101 131 102 112 100 ...</span>
<span class="co">#&gt;  $ sqrt_x: num  0.316 0.316 0.316 0.316 0.316 ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">raw_x</span><span class="op">)</span>
<span class="co">#&gt; [1]   0.1 190.0</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">raw_x</span>, xlab <span class="op">=</span> <span class="st">"'x' variable"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">count</span>, xlab <span class="op">=</span> <span class="st">"Total counts"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-20-1.png" title="plot of chunk unnamed-chunk-20" alt="plot of chunk unnamed-chunk-20" width="100%"></p>
<p>First, we supply <code>bnec</code> with <code>data</code> (count_data), and specify <code>x_var</code> and <code>y_var</code>. As we have integers of 0 and greater, the <code>family</code> is “poisson”. The default behaviour to guess the variable types works for this example.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span>, x_var <span class="op">=</span> <span class="st">"sqrt_x"</span>,
              y_var <span class="op">=</span> <span class="st">"count"</span>, model <span class="op">=</span> <span class="st">"neclin"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b0d7ff4a6b0c9747c0ef05a4b7e89ac8' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 4.8e-05 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.48 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 2.46017 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.335978 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                2.79615 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b0d7ff4a6b0c9747c0ef05a4b7e89ac8' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 1.8e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 2.96708 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.327268 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                3.29435 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b0d7ff4a6b0c9747c0ef05a4b7e89ac8' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 2.1e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.21 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 0.602879 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.077856 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                0.680735 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b0d7ff4a6b0c9747c0ef05a4b7e89ac8' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 1.9e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.19 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 0.987625 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.498165 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                1.48579 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<p>We first plot the model chains and parameter estimates to check the fit.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_3</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-22-1.png" title="plot of chunk unnamed-chunk-22" alt="plot of chunk unnamed-chunk-22" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_3</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-23-1.png" title="plot of chunk unnamed-chunk-23" alt="plot of chunk unnamed-chunk-23" width="100%"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_3</span><span class="op">$</span><span class="va">dispersion</span>
<span class="co">#&gt; Estimate     Q2.5    Q97.5 </span>
<span class="co">#&gt; 3.361285 1.991797 5.519465</span></code></pre></div>
<p>The chains look ok; however, our plot of the fit is not very convincing. The error bars are very narrow, and this does not seem to be a particularly good model for these data. Note that the dispersion estimate is much greater than one, indicating serious overdispersion. In this case we can try a negative binomial family.</p>
</div>
<div id="negative-binomial" class="section level3">
<h3 class="hasAnchor">
<a href="#negative-binomial" class="anchor" aria-hidden="true"></a>Negative binomial</h3>
<p>When count data are overdispersed and cannot be modelled using the poisson family, the negative binomial family is generally used. We can do this by calling <code>family = "negbinomial"</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span>, x_var <span class="op">=</span> <span class="st">"sqrt_x"</span>,
              y_var <span class="op">=</span> <span class="st">"count"</span>, family <span class="op">=</span> <span class="st">"negbinomial"</span>, model <span class="op">=</span> <span class="st">"neclin"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b00819b13477ed73c05459704383ad86' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 5.4e-05 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.54 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 4.599 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.681803 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                5.2808 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b00819b13477ed73c05459704383ad86' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 2.5e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.25 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 4.8448 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.621595 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                5.4664 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b00819b13477ed73c05459704383ad86' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 2.9e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.29 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 4.88644 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.691177 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                5.57761 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'b00819b13477ed73c05459704383ad86' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 2.9e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.29 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 4.81602 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.548506 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                5.36452 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<p>The resultant plot seems to indicate the negative binomial family works better in terms of dispersion (more sensible wider confidence bands) however it still does not seem to be a good model for these data. See the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> and <a href="https://open-aims.github.io/bayesnec/articles/example2.html" class="external-link">Multi model usage</a> vignettes for options to fit other models to these data.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_3b</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-25-1.png" title="plot of chunk unnamed-chunk-25" alt="plot of chunk unnamed-chunk-25" width="100%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_3b</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-26-1.png" title="plot of chunk unnamed-chunk-26" alt="plot of chunk unnamed-chunk-26" width="100%"></p>
</div>
<div id="measure-data" class="section level3">
<h3 class="hasAnchor">
<a href="#measure-data" class="anchor" aria-hidden="true"></a>Measure data</h3>
<p>Where data are a measured variable y is family gamma. Good examples of <code>gamma</code> distributed data include measures of body size, such as length, weight, or area. Such data are distributed from <code>0+</code> to <code>Inf</code> and are continuous. Here we use the nec_data supplied with <code>bayesnec</code> with y on the exponential scale to ensure the right data range for a gamma as an example.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span>
<span class="va">measure_data</span> <span class="op">&lt;-</span> <span class="va">nec_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span>
<span class="va">exp_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">measure_data</span>, x_var <span class="op">=</span> <span class="st">"x"</span>,
              y_var <span class="op">=</span> <span class="st">"measure"</span>, model <span class="op">=</span> <span class="st">"neclin"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '66a3c69058cc57a98f33c1c6d389c60a' NOW (CHAIN 1).</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Gradient evaluation took 6.2e-05 seconds</span>
<span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.62 seconds.</span>
<span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 1: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; Chain 1:  Elapsed Time: 1.68346 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 1:                0.253453 seconds (Sampling)</span>
<span class="co">#&gt; Chain 1:                1.93692 seconds (Total)</span>
<span class="co">#&gt; Chain 1: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '66a3c69058cc57a98f33c1c6d389c60a' NOW (CHAIN 2).</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Gradient evaluation took 3.2e-05 seconds</span>
<span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.32 seconds.</span>
<span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 2: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; Chain 2:  Elapsed Time: 1.68701 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 2:                0.251297 seconds (Sampling)</span>
<span class="co">#&gt; Chain 2:                1.9383 seconds (Total)</span>
<span class="co">#&gt; Chain 2: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '66a3c69058cc57a98f33c1c6d389c60a' NOW (CHAIN 3).</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Gradient evaluation took 3e-05 seconds</span>
<span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.3 seconds.</span>
<span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 3: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; Chain 3:  Elapsed Time: 1.65836 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 3:                0.243536 seconds (Sampling)</span>
<span class="co">#&gt; Chain 3:                1.9019 seconds (Total)</span>
<span class="co">#&gt; Chain 3: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL '66a3c69058cc57a98f33c1c6d389c60a' NOW (CHAIN 4).</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Gradient evaluation took 3.1e-05 seconds</span>
<span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.31 seconds.</span>
<span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 6000 / 10000 [ 60%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 7000 / 10000 [ 70%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 8000 / 10000 [ 80%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9000 / 10000 [ 90%]  (Warmup)</span>
<span class="co">#&gt; Chain 4: Iteration: 9001 / 10000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)</span>
<span class="co">#&gt; Chain 4: </span>
<span class="co">#&gt; Chain 4:  Elapsed Time: 1.67697 seconds (Warm-up)</span>
<span class="co">#&gt; Chain 4:                0.240911 seconds (Sampling)</span>
<span class="co">#&gt; Chain 4:                1.91788 seconds (Total)</span>
<span class="co">#&gt; Chain 4:</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_4</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-29-1.png" title="plot of chunk unnamed-chunk-29" alt="plot of chunk unnamed-chunk-29" width="100%"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exp_4</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-30-1.png" title="plot of chunk unnamed-chunk-30" alt="plot of chunk unnamed-chunk-30" width="100%"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">exp_4</span><span class="op">)</span>
<span class="co">#&gt; Object of class bayesnecfit containing the following non-linear model: neclin</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Family: gamma </span>
<span class="co">#&gt;   Links: mu = log; shape = identity </span>
<span class="co">#&gt; Formula: y ~ top - exp(slope) * (x - nec) * step(x - nec) </span>
<span class="co">#&gt;          top ~ 1</span>
<span class="co">#&gt;          slope ~ 1</span>
<span class="co">#&gt;          nec ~ 1</span>
<span class="co">#&gt;    Data: structure(list(x = c(1.01874617094183, 0.815747457 (Number of observations: 100) </span>
<span class="co">#&gt; Samples: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup samples = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; top_Intercept       0.89      0.01     0.88     0.91 1.00     2491     2484</span>
<span class="co">#&gt; slope_Intercept    -0.59      0.04    -0.68    -0.51 1.00     2035     2325</span>
<span class="co">#&gt; nec_Intercept       1.31      0.04     1.23     1.38 1.00     1839     1992</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; shape   248.17     37.37   182.02   323.79 1.00     2846     2125</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>In this case our model has converged well, although it is perhaps not the best model to fit. See the <a href="https://open-aims.github.io/bayesnec/articles/example2b.html" class="external-link">Model details</a> and <a href="https://open-aims.github.io/bayesnec/articles/example2.html" class="external-link">Multi model usage</a> vignettes for options to fit other models to these data.</p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Burkner2017">
<p>Bürkner, Paul Christian. 2017. “brms: An R package for Bayesian multilevel models using Stan.” <em>Journal of Statistical Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.</p>
</div>
<div id="ref-Burkner2018">
<p>Bürkner, Paul-Christian. 2018. “Advanced Bayesian Multilevel Modeling with the R Package brms.” <em>The R Journal</em> 10 (1): 395–411. <a href="https://doi.org/10.32614/RJ-2018-017" class="external-link">https://doi.org/10.32614/RJ-2018-017</a>.</p>
</div>
<div id="ref-Fisher2020">
<p>Fisher, Rebecca, Gerard Ricardo, and David Fox. 2020. “Bayesian concentration-response modelling using jagsNEC.” <a href="https://doi.org/10.5281/ZENODO.3966864" class="external-link">https://doi.org/10.5281/ZENODO.3966864</a>.</p>
</div>
<div id="ref-Fox2010">
<p>Fox, David R. 2010. “A Bayesian approach for determining the no effect concentration and hazardous concentration in ecotoxicology.” <em>Ecotoxicology and Environmental Safety</em> 73 (2): 123–31.</p>
</div>
<div id="ref-Plummer2003">
<p>Plummer, Martyn. 2003. “JAGS: A program for analysis of Bayesian graphical models using Gibbs sampling.” In <em>Proceedings of the 3rd International Workshop on Distributed Statistical Computing (DSC 2003)</em>, 1–10. Technische Universität Wien, Vienna, Austria: Achim Zeileis.</p>
</div>
<div id="ref-Ritz2016">
<p>Ritz, Christian, Florent Baty, Jens C Streibig, and Daniel Gerhard. 2016. “Dose-Response Analysis Using R.” <em>PLoS ONE</em> 10 (12): e0146021. <a href="https://doi.org/10.1371/journal.pone.0146021" class="external-link">https://doi.org/10.1371/journal.pone.0146021</a>.</p>
</div>
<div id="ref-Su2015">
<p>Su, Yu-Sung, and Masanao Yajima. 2015. <em>R2jags: Using R to Run ’JAGS’</em>. <a href="https://CRAN.R-project.org/package=R2jags" class="external-link">https://CRAN.R-project.org/package=R2jags</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
