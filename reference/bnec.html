<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>bnec — bnec • bayesnec</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="bnec — bnec"><meta property="og:description" content="Fits a variety of NEC models using Bayesian analysis and provides a model
averaged predictions based on WAIC model weights"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example2b.html">Model details</a>
    </li>
    <li>
      <a href="../articles/example3.html">Priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/open-aims/bayesnec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>bnec</h1>
    <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/HEAD/R/bnec.R" class="external-link"><code>R/bnec.R</code></a></small>
    <div class="hidden name"><code>bnec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a variety of NEC models using Bayesian analysis and provides a model
averaged predictions based on WAIC model weights</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bnec</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  x_range <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  sig_val <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  <span class="va">loo_controls</span>,</span>
<span>  x_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trials_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>Either a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> string defining an
R formula or an actual <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> object. See
<code><a href="bayesnecformula.html">bayesnecformula</a></code> and <code><a href="check_formula.html">check_formula</a></code>.</p></dd>


<dt>data</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> containing the data to use with
the <code>formula</code>.</p></dd>


<dt>x_range</dt>
<dd><p>A range of predictor values over which to consider extracting
ECx.</p></dd>


<dt>precision</dt>
<dd><p>The length of the predictor vector used for posterior
predictions, and over which to extract ECx values. Large values will be
slower but more precise.</p></dd>


<dt>sig_val</dt>
<dd><p>Probability value to use as the lower quantile to test
significance of the predicted posterior values against the lowest observed
concentration (assumed to be the control), to estimate NEC as an
interpolated NOEC value from smooth ECx curves.</p></dd>


<dt>loo_controls</dt>
<dd><p>A named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> of two elements
("fitting" and/or "weights"), each being a named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code>
containing the desired arguments to be passed on to <code><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></code>
(via "fitting") or to <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code> (via "weights").
If "fitting" is provided with argument <code>pointwise = TRUE</code>
(due to memory issues) and <code>family = "beta_binomial2"</code>, the
<code>bnec</code> will fail because that is a custom family. If "weights" is
not provided by the user, <code>bnec</code> will set the default
<code>method</code> argument in <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code> to
"pseudobma". See ?<code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code> for further info.</p></dd>


<dt>x_var</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> indicating the column heading
containing the predictor (concentration) variable.</p></dd>


<dt>y_var</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> indicating the column heading
containing the response variable.</p></dd>


<dt>trials_var</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> indicating the column
heading for the number of "trials" for binomial or beta_binomial2 response
data, as it appears in "data" (if data is supplied).</p></dd>


<dt>model</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> vector indicating the model(s)
to fit. See Details for more information.</p></dd>


<dt>random</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> containing the random model
formula to apply to model parameters.</p></dd>


<dt>random_vars</dt>
<dd><p>Removed in version 2.0. Use formula instead. Used to be a
<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> vector containing the
names of the columns containing the variables used in the random model
formula.</p></dd>


<dt>...</dt>
<dd><p>Further arguments to <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If argument model is a single string, then an object of class
<code><a href="bayesnecfit-class.html">bayesnecfit</a></code>; if many strings or a set,
an object of class <code><a href="bayesmanecfit-class.html">bayesmanecfit</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><b>Overview</b></p>
<p><code>bnec</code> serves as a wrapper for (currently) 23 (mostly) non-linear
equations that are classically applied to concentration(dose)-response
problems. The primary goal of these equations is to provide the user with
estimates of No-Effect-Concentration (NEC),
No-Significant-Effect-Concentration (NSEC), and Effect-Concentration
(of specified percentage 'x', <em>ECx</em>) thresholds.
These in turn are fitted through the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> function from
package <span class="pkg">brms</span> and therefore further arguments to <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code>
are allowed. In the absence of those arguments, <code>bnec</code> makes
its best attempt to calculate distribution family, priors and initialisation
values for the user based on the characteristics of the data. Moreover, in
the absence of user-specified values, <code>bnec</code> sets the number of
iterations to 1e4 and warmup period to <code>floor(iterations / 5) * 4</code>.
The chosen models can be extended by the addition of <span class="pkg">brms</span> special
"aterms" as well as group-level effects. See <code>?<a href="bayesnecformula.html">bayesnecformula</a></code>
for details.</p>
<p><b>The available models/equations/formulas</b></p>
<p>The available equations (or models) can be found via the <code><a href="models.html">models</a></code>
function. Since version 2.0, <code>bnec</code> requires a specific formula
structure
which is fully explained in the help file of <code><a href="bayesnecformula.html">bayesnecformula</a></code>.
This formula incorporates the information regarding the chosen model(s). If
one single model is specified, <code>bnec</code> will return an object of
class <code><a href="bayesnecfit-class.html">bayesnecfit</a></code>; otherwise if model is either a concatenation
of multiple models and/or a string indicating a family of models,
<code>bnec</code> will return an object of class
<code><a href="bayesmanecfit-class.html">bayesmanecfit</a></code>, providing they were successfully fitted. The
major difference being that the output of the latter includes Bayesian model
averaging statistics. These classes come with multiple associated
methods such as <code><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></code>,
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></code>, <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></code>,
<code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></code> and <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>.</p>
<p><code>model</code> may also be one of "all", meaning all of the available models
will be fit; "ecx" meaning only models excluding a specific NEC step
parameter will be fit; "nec" meaning only models with a specific NEC step
parameter will be fit; "bot_free" meaning only models without a "bot"
parameter (without a bottom plateau) will be fit; "zero_bounded" are models
that are bounded to be zero; or "decline" excludes all hormesis models, i.e.,
only allows a strict decline in response across the whole predictor range.
Notice that if one of these group strings is provided together with a
user-specified named list for the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code>'s argument
<code>prior</code>, the list names need to contain
the actual model names, and not the group string , e.g. if
<code>model = "ecx"</code> and <code>prior = my_priors</code> then
<code>names(my_priors)</code> must contain <code>models("ecx")</code>. To check
available models and associated parameters for each group,
use the function <code><a href="models.html">models</a></code> or to check the parameters of a
specific model use the function <code><a href="show_params.html">show_params</a></code>.</p>
<p>All models provide an estimate for NEC. For model types with "nec" as a
prefix, NEC is directly estimated as parameter "nec"
in the model. Models with "ecx" as a prefix are continuous curve models,
typically used for extracting ECx values
from concentration response data. In this instance the NEC value is defined
as the concentration at which there is a user supplied
(see argument <code>sig_val</code>) percentage certainty
(based on the Bayesian posterior estimate) that the response
falls below the estimated value of the upper asymptote (top) of the
response (i.e. the response value is significantly
lower than that expected in the case of no exposure).
The default value for <code>sig_val</code> is 0.01, which corresponds to an alpha
value of 0.01 for a one-sided test of significance.</p>
<p><b>Further argument to <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code></b></p>
<p>If not supplied via the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> argument <code>family</code>, the
appropriate distribution will be guessed based on the characteristics of the
input data. Guesses include: "bernoulli" / bernoulli / bernoulli(), "Beta" /
Beta / Beta(), "binomial" / binomial / binomial(), "beta_binomial2" /
beta_binomial2, "Gamma" / Gamma / Gamma(), "gaussian" / gaussian /
gaussian(), "negbinomial" / negbinomial / negbinomial(), or "poisson" /
poisson / poisson(). Note, however, that "negbinomial" and "betabinomimal2"
require knowledge on whether the data is over-dispersed. As
explained below in the Return section, the user can extract the dispersion
parameter from a <code>bnec</code> call, and if they so wish, can refit the
model using the "negbinomial" family.</p>
<p>Other families can be considered as required, please raise an
<a href="https://github.com/open-AIMS/bayesnec/issues" class="external-link">issue</a> on the GitHub
development site if your required family is not currently available.</p>
<p>As a default, <code>bnec</code> sets the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> argument
<code>sample_prior</code> to "yes" in order to sample draws from the priors in
addition to the posterior distributions. Among others, these samples can be
used to calculate Bayes factors for point hypotheses via
<code><a href="https://paul-buerkner.github.io/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></code>.</p>
<p>Model averaging is achieved through a weighted sample of each fitted models
posterior predictions, with weights derived using functions
<code><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></code> and <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code> from
<span class="pkg">brms</span>. Argument to both these functions can be passed via the
<code>loo_controls</code> argument. Individual model fits can be pulled out
for examination using function <code><a href="pull_out.html">pull_out</a></code>.</p>
<p><b>Additional technical notes</b></p>
<p>As some concentration-response data will use zero concentration
which can cause numerical estimation issues, a small offset is added (1 /
10th of the next lowest value) to zero values of concentration where
<code>x_var</code> are distributed on a continuous scale from 0 to infinity, or
are bounded to 0, or 1.</p>
<p><b>NAs are thrown away</b></p>
<p>Stan's default behaviour is to fail when the input data contains NAs. For
that reason <span class="pkg">brms</span> excludes any NAs from input data prior to fitting,
and does not allow them back in as is the case with e.g. <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm</a></code> and
<code>na.action = exclude</code>. So we advise that you exclude any NAs in your
data prior to fitting because if you so wish that should facilitate merging
predictions back onto your original dataset.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="bayesnecformula.html">bayesnecformula</a></code>,
<code><a href="check_formula.html">check_formula</a></code>,
<code><a href="models.html">models</a></code>,
<code><a href="show_params.html">show_params</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec/" class="external-link">bayesnec</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A single model</span></span></span>
<span class="r-in"><span><span class="va">exmp_a</span> <span class="op">&lt;-</span> <span class="fu">bnec</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="st">"nec4param"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">nec_data</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Two models model</span></span></span>
<span class="r-in"><span><span class="va">exmp_b</span> <span class="op">&lt;-</span> <span class="fu">bnec</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nec4param"</span>, <span class="st">"ecx4param"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">nec_data</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

