<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Set up a model formula for use in
bayesnec — bayesnecformula • bayesnec</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Set up a model formula for use in
bayesnec — bayesnecformula"><meta property="og:description" content="Set up a model formula for use in the
bayesnec package, allowing linear
and non-linear (potentially multi-level) concentration-response
models to be defined."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example2b.html">Model details</a>
    </li>
    <li>
      <a href="../articles/example3.html">Priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/open-aims/bayesnec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set up a model formula for use in
<code><a href="bayesnec-package.html">bayesnec</a></code></h1>
    <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/HEAD/R/bayesnecformula.R" class="external-link"><code>R/bayesnecformula.R</code></a></small>
    <div class="hidden name"><code>bayesnecformula.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Set up a model formula for use in the
<code><a href="bayesnec-package.html">bayesnec</a></code> package, allowing linear
and non-linear (potentially multi-level) concentration-response
models to be defined.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bayesnecformula</span><span class="op">(</span><span class="va">formula</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>Either a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> string defining an
R formula or an actual <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> object. See details.</p></dd>


<dt>...</dt>
<dd><p>Unused.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>bayesnecformula</code> and
<code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>See <code>methods(class = "bayesnecformula")</code> for an overview of
available methods.</p>
<p><b>General formula syntax</b></p>
<p>The <code>formula</code> argument accepts formulas of the following syntax:</p>
<p><code>response | aterms ~ crf(x, model) + glterms</code></p>
<p><b>The population-level term: <code>crf</code></b></p>
<p><code><a href="bayesnec-package.html">bayesnec</a></code> uses a special internal
term called <code>crf</code>, which sets the concentration-response equation
to be evaluated based on some <code>x</code> predictor. The equation itself is
defined by the argument <code>"model"</code>: a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code>
vector containing a specific model, a concatenation of specific models,
or a single string defining a particular group of models
(or group of equations, see <code><a href="models.html">models</a></code>). Internally
this argument is substituted by an actual <code><a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">brmsformula</a></code>,
which is then passed onto <code><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></code> for model fitting.</p>
<p><b>Group-level terms: <code>glterms</code></b></p>
<p>The user has three options to define group-level effects in a
<code>bayesnecformula</code>: 1) a general "offset" group-level effect
defined by the term <code>ogl</code> (as in e.g. <code>ogl(group_variable)</code>). This
adds an additional population-level parameter <code>ogl</code> to the model defined
by <code>crf</code>, analogously to an intercept-only group-level effect
in a classic linear model. 2) A group-level effect applied to all
parameters in a model at once. This is done by the special term <code>pgl</code>,
(as in e.g. <code>pgl(group_variable)</code>), which comes in handy so the user
does not need to know the internal syntax and name of each parameter in the
model. 3) A more classic approach where the user can specify which
specific parameters --- NB: that requires prior knowledge on the model
structure and parameter names --- to vary according to a grouping variable
(as in e.g. <code>(bot | group_variable)</code>). <code>bayesnecformula</code>
will ignore this term should the parameter not exist in the specified model
or model suite. For example, the parameter <code>bot</code> exists in model
<code>"nec4param"</code> but not in <code>"nec3param"</code>, so if the user specifies
<code>model = "nec"</code> in <code>crf</code>, the term <code>(bot | group_variable)</code>
will be dropped in models where that parameter does not exist.</p>
<p><b>Further brms terms (largely untested)</b></p>
<p>Currently <code>bayesnecformula</code> is quite agnostic about additional
terms that are valid for a <code><a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">brmsformula</a></code>. These are
<code>aterms</code> and <code>pterms</code> (see <code>?<a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">brmsformula</a></code>).
The only capability that <code>bayesnecformula</code> does not allow is
the addition of <code>pterms</code> outside of the term <code>crf</code>. Although
<code>pterms</code> can be passed to predictor <code>x</code> within <code>crf</code>, we
strongly discourage their use because those functionalities have not
been tested yet. If this is extremely important to your work, please
raise an issue on bayesnec GitHub, and we will consider further testing and
development.
Currently, the only two <code>aterms</code> that have validated behaviour are:</p><ol><li><p><code>trials()</code>, which is essential in binomially-distributed data, e.g.
<code>y | trials(trials_variable)</code>, and 2) weights, e.g.
<code>y | weights(weights_variable)</code>, following <span class="pkg">brms</span> formula syntax.
Please note that <span class="pkg">brms</span> does not implement design weights as in other
standard <span class="pkg">base</span> functions. From their help page, <span class="pkg">brms</span> "takes the
weights literally, which means that an observation with weight 2 receives 2
times more weight than an observation with weight 1. It also means that
using a weight of 2 is equivalent to adding the corresponding observation
twice to the data frame". Other <code>aterms</code> might be added, though we
cannot attest to their functionality within
<code><a href="bayesnec-package.html">bayesnec</a></code>, i.e. checks will
be done outside via <code><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></code>.</p></li>
</ol><p><strong>NB:</strong> <code>aterms</code> other than <code>trials()</code> and <code><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights()</a></code> are
currently omitted from <code><a href="model.frame.html">model.frame</a></code> output. If you need other
<code>aterms</code> as part of that output please raise an issue on our GitHub
page.</p>
<p><b>Validation of formula</b>
Please note that the function only checks for the input nature of the
<code>formula</code> argument and adds a new class. This function <strong>does not</strong>
perform any validation on the model nor checks on its adequacy to work with
other functions in the package. For that please refer to the function
<code><a href="check_formula.html">check_formula</a></code> which requires the dataset associated with the
formula.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="check_formula.html">check_formula</a></code>,
<code><a href="model.frame.html">model.frame</a></code>,
<code><a href="models.html">models</a></code>,
<code><a href="show_params.html">show_params</a></code>,
<code><a href="make_brmsformula.html">make_brmsformula</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec/" class="external-link">bayesnec</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">bayesnecformula</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, <span class="st">"nec3param"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y ~ crf(x, "nec3param")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5652af0b3f58&gt;</span>
<span class="r-in"><span><span class="co"># or use shot alias bnf</span></span></span>
<span class="r-in"><span><span class="fu">bayesnecformula</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, <span class="st">"nec3param"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu">bnf</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, <span class="st">"nec3param"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">bnf</span><span class="op">(</span><span class="va">y</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"nec3param"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y | trials(tr) ~ crf(sqrt(x), "nec3param")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5652af0b3f58&gt;</span>
<span class="r-in"><span><span class="fu">bnf</span><span class="op">(</span><span class="va">y</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, <span class="st">"nec3param"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ogl</span><span class="op">(</span><span class="va">group_1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">pgl</span><span class="op">(</span><span class="va">group_2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y | trials(tr) ~ crf(x, "nec3param") + ogl(group_1) + pgl(group_2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5652af0b3f58&gt;</span>
<span class="r-in"><span><span class="fu">bnf</span><span class="op">(</span><span class="va">y</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="va">x</span>, <span class="st">"nec3param"</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">nec</span> <span class="op">+</span> <span class="va">top</span> <span class="op">|</span> <span class="va">group_1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y | trials(tr) ~ crf(x, "nec3param") + (nec + top | group_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5652af0b3f58&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># complex transformations are not advisable because</span></span></span>
<span class="r-in"><span><span class="co"># they are passed directly to Stan via brms</span></span></span>
<span class="r-in"><span><span class="co"># and are likely to fail -- transform your variable beforehand!</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">bnf</span><span class="op">(</span><span class="va">y</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">~</span> <span class="fu">crf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"nec3param"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y | trials(tr) ~ crf(scale(x, scale = TRUE), "nec3param")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5652af0b3f58&gt;</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

